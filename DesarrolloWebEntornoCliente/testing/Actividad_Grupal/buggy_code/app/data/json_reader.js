const fs = require('fs');
const jsonConstants = require('./dataset_utils').datasetConstants;
const jsonReader = require('read-json-sync');
const Player =  require('./player').Player;

/**
 * Function that iterates over a collection of JSON objects containing player profiles and extracts the relevant data to create an Array of Player
 * @param {Object} jsonObject The collection of player profiles
 * @returns {Array<Player>} The collection of players created from the JSON file 
 */
function extractDataFromRawJSON(jsonObject){
    let playerData = [];
    for(let player of jsonObject){
        let id = player[jsonConstants.player_id];
        let playerObj = Player.fromDatasetJSONObject(id,player);
        
        playerData.push(playerObj);
    }
    return playerData;
}

/**
 * Function that takes a string representing a path to a JSON file and parses it
 * @param {String} filename the path to the JSON file
 * @returns {Object} An object generated by parsing the JSON file
 * @throws {Error} in case that there were problems parsing the JSON file
 */
function readJSONData(filename){
    let jsonObject = undefined;
    try{
        jsonObject = jsonReader(filename);
    } catch(error){
        if(error instanceof SyntaxError){
            throw new SyntaxError('JSON in incorrect format');
        } 
        else throw Error('Problem reading the file');
    }
    return jsonObject;
}

exports.readJSONData = readJSONData;
exports.extractDataFromRawJSON =extractDataFromRawJSON;